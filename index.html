<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>helloworld</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        background: #f0f0f0;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
      }

      #myCanvas {
        background-color: #1a1a2e;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        display: block; /* 移除默认的inline间隙 */
      }
    </style>
  </head>
  <body>
    <canvas id="myCanvas" width="600" height="600"></canvas>

    <script>
      const canvas = document.getElementById("myCanvas");
      const ctx = canvas.getContext("2d");
      const FOREGROUND = "#50ff50";

      // 用矩形填充整个画布作为背景
      function setBackground(color) {
        ctx.fillStyle = color;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }

      // 设置背景颜色
      setBackground("#1a1a2e");

      // 设置渐变背景
      function setGradientBackground() {
        const gradient = ctx.createLinearGradient(
          0,
          0,
          canvas.width,
          canvas.height
        );
        gradient.addColorStop(0, "#1a1a2e");
        gradient.addColorStop(1, "#16213e");

        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }

      setGradientBackground();

      function clear() {
        setBackground("#1a1a2e");
      }

      function screen({ x, y }) {
        return {
          // -1..1 => 0..w
          // -1..1 => h..0
          x: ((x + 1) / 2) * canvas.width,
          y: ((1 - y) / 2) * canvas.height,
        };
      }

      function point({ x, y }) {
        w = 5;
        ctx.fillStyle = FOREGROUND;
        ctx.fillRect(x - w / 2, y - w / 2, w, w);
      }

      function project({ x, y, z }) {
        return {
          x: x / z,
          y: y / z,
        };
      }

      function translate_z({x, y, z}, dz) {
        return {
            x, 
            y,
            z: z + dz
        }
      }

      function rotate_xz({x, y, z}, angle) {
        const c = Math.cos(angle)
        const s = Math.sin(angle)
        return {
            x: x*c - z*s,
            y,
            z: x*s + z*c
        }
      }
      function line(p1, p2) {
        ctx.strokeStyle = FOREGROUND;
        ctx.beginPath();
        ctx.moveTo(p1.x, p1.y);
        ctx.lineTo(p2.x, p2.y);
        ctx.stroke();
      }
      
      function _face(points) {
        ctx.strokeStyle = FOREGROUND;
        ctx.fillStyle = FOREGROUND
        ctx.beginPath();
        p1 = points[0]
        ctx.moveTo(p1.x, p1.y);
        for (let i = 1; i < points.length; i++) {
          p = points[i]
          ctx.lineTo(p.x, p.y)
        }
        ctx.closePath()
        ctx.fill()
      }

      const points = [
        { x: -0.25, y: 0.25, z: 0.25 },
        { x: 0.25, y: 0.25, z: 0.25 },
        { x: 0.25, y: -0.25, z: 0.25 },
        { x: -0.25, y: -0.25, z: 0.25 },

        { x: -0.25, y: 0.25, z: -0.25 },
        { x: 0.25, y: 0.25, z: -0.25 },
        { x: 0.25, y: -0.25, z: -0.25 },
        { x: -0.25, y: -0.25, z: -0.25 },
      ];

      const faces = [[0, 1, 2, 3], [4, 5, 6, 7], [0, 4], [1, 5], [2, 6], [3, 7]];
      // const faces = [[3, 2, 6, 7], [0, 1, 5, 4], [0, 3], [1, 2], [6, 5], [4, 7] ]

      const FPS = 60;
      let dz = 1;
      let angle = 0;
      const forward = true
      function frame() {
        clear();
        const dt = 1 / FPS;
        // dz += 1 * dt;
        angle += 1 * Math.PI * dt
        for (const p of points) {
        //   p.z = forward ? (p.z -= dz) : (p.z += dz);
        }
        for (let j = 0; j < faces.length; j++) {
            const face = faces[j]
            // if (j == 1) {
              // ps = face.map(f => screen(project(translate_z(rotate_xz(points[f], angle), dz))))
              // _face(ps)
              // continue
            // }
            for (let i = 0; i < face.length; i++) {
                p1 = screen(project(translate_z(rotate_xz(points[face[i]], angle), dz)))
                p2 = screen(project(translate_z(rotate_xz(points[face[(i + 1) % face.length]], angle), dz)))
                line(p1, p2)
            }
        }
        setTimeout(frame, 1000 / FPS);
      }
      frame();
    </script>
  </body>
</html>
